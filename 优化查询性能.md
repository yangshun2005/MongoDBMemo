#优化查询性能

##为查询创建索引

针对一般查询，可创建索引，查询多个字段时，创建一个复合索引。
扫描索引的速度要比扫描整个集合要快得多。索引结构要比其引用的文档要小，并将引用的文档按顺序存储。

>EXAMPLE 

>如果你有一个posts集合，其中存有博客文章，如果你经常使用以author_name字段排序的查询，你可以在author_name字段上创建索引：

>db.posts.createIndex( {author_name : 1} )

索引能够改进按指定字段排序的常用查询的性能。

>EXAMPLE

>如果你经常使用按时间戳字段排序的查询，你可以创建时间戳上的索引来优化查询。

>创建这个索引：

>db.posts.createIndex( { timestamp : 1 } )

>优化查询：

>db.posts.find().sort( { timestamp : -1 } )

由于MongoDB既可以用升序也可以用降序的方式读取索引，所以单一字段上的索引方向没什么关系。

索引支持查询和更新操作，和一部分抽取集合的的操作。

满足以下条件的二进制数据类型键在索引中存储得更高效：

二进制子类型的值在0-7或者128-135，字节数组的长度是：0, 1, 2, 3, 4, 5, 6, 7, 8, 10, 12, 14, 16, 20, 24, 或 32。

##限制返回的查询结果数来减少对网络带宽需求。

MongoDB游标返回一组文档。如果你确切知道你需要的结果个数，你可以使用`limit()`方法来节约带宽。

>以下是一个典型的结合排序操作的使用场景,例如，你只需要从你的posts集合中查询出10个结果，你可以使用这个命令：

>db.posts.find().sort( { timestamp : -1 } ).limit(10)

使用Projections返回必要的数据。

当你只需要文档中一部分字段的数据，你可以让查询只返回必要的字段来提高查询性能：

例如，你要查询posts集合，但你仅需要timestamp,title,author和abstract字段，你可以使用以下命令：

>db.posts.find( {}, { timestamp : 1 , title : 1 , author : 1 , abstract : 1} ).sort( { timestamp : -1 } )


##使用$hint选中指定索引

多少情况下，查询优化器会为指定操作选择最优的索引；然而，你也可以通过`hint()`让MongoDB强制使用指定的索引，使用`hint()`做性能测试或者某些查询你必须选择一个被包含在多个索引中的字段。

##在服务器端使用自增操作

使用MongoDB的 `$inc` 操作符做文档中值的增加或减少，该操作在服务器端增加字段的值，相对查询一个文档，做简单的修改再将整个文档写入服务器.`$inc`操作能避免两个应用实例同时查询一份文档并写回整个文档所带来的竞争。
